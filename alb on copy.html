<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ürün Fiyat Tablosu</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0px;
            padding: 5px;
            display: block;
            overflow-x: auto;
            font-size: 12px;
        }

        table,
        th,
        td {
            border: 0.5px solid #ced4da;
            padding: 4px 6px;
            text-align: center;
            font-size: 12px;
            background: #f8f9fa;
        }

        table {
            width: auto;
            min-width: 100%;
            font-size: 12px;
            table-layout: auto;
            border-collapse: separate;
            border-spacing: 0;
            border: 1px solid #007bff;
            border-radius: 8px;
            overflow: hidden;
        }

        th {
            background: #ddd;
            white-space: nowrap;
            min-width: 60px;
            width: 60px;
            font-size: 12px;
            font-weight: bold;
        }
        
        td {
            white-space: nowrap;
            min-width: 60px;
            width: 60px;
            font-size: 11px;
        }
        
        td:first-child, th:first-child {
            min-width: 100px;
            width: 100px;
            border-right: 2px solid #007bff;
        }
        
        /* Z-index katmanlaması */
        /* En önde: İlk sütun th:first-child (9999) */
        /* İkinci önde: İlk sütundaki En-header (9998) */
        /* Ortada: T-header'lar (5) */
        /* Arkada: Diğer En-header'lar (1) */
        /* Normal: Diğer hücreler (auto) */
        

        .wrapper {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
            
        .table-container {
            overflow-x: auto;
            overflow-y: visible;
            width: calc(100% - 10px);
            margin-bottom: 8px;
            border: 3px solid #007bff;
            border-radius: 12px;
            background: white;
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.2);
            position: relative;
        }
        
        .table-container::-webkit-scrollbar {
            height: 12px;
        }
        
        .table-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 6px;
        }
        
        .table-container::-webkit-scrollbar-thumb {
            background: #007bff;
            border-radius: 6px;
        }
        
        .table-container::-webkit-scrollbar-thumb:hover {
            background: #0056b3;
        }
        .flexbox {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        #dynamicContainers {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: flex-start;
        }
        .topmaliyet {
            display: flex;
            justify-content: space-around;
            gap: 8px;
            margin-top: 8px;
        }
        
        .total-box {
            background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 100%);
            border: 2px solid #28a745;
            border-radius: 6px;
            padding: 8px 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.15);
            text-align: center;
            flex: 1;
            min-width: 180px;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }
        
        .total-box-indicators {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        
        .total-box-indicators .box-indicator {
            width: 18px;
            height: 18px;
            font-size: 10px;
        }
        
        .total-box-indicators span {
            font-size: 14px;
            font-weight: bold;
            color: #6c757d;
        }
        
        .total-box.maliyet {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border-color: #ffc107;
        }
        
        .box-indicator {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            color: white;
        }
        
        .box-indicator.box1 { background: #007bff; border-color: #007bff; }
        .box-indicator.box2 { background: #28a745; border-color: #28a745; }
        .box-indicator.box3 { background: #ffc107; border-color: #ffc107; color: #000; }
        .box-indicator.box4 { background: #dc3545; border-color: #dc3545; }
        .box-indicator.box5 { background: #6f42c1; border-color: #6f42c1; }
        .box-indicator.box6 { background: #fd7e14; border-color: #fd7e14; }
        .box-indicator.box7 { background: #20c997; border-color: #20c997; }
        .box-indicator.box8 { background: #e83e8c; border-color: #e83e8c; }
        
        .cost-options {
            margin: 10px 0;
            padding: 8px 10px;
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 6px;
            display: flex;
            gap: 20px;
            justify-content: space-between;
        }
        
        .option-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        .radio-group {
            display: flex;
            gap: 12px;
            margin-top: 3px;
        }
        
        .radio-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 10px;
            color: #856404;
            margin: 0;
        }
        
        .radio-label:hover {
            color: #5a4103;
        }
        
        .radio-label input[type="radio"] {
            width: auto;
            margin: 0 5px 0 0;
            padding: 0;
        }
        
        .maliyet-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 12px;
        }
        
        .maliyet-left {
            flex: 1;
            min-width: 0;
        }
        
        .maliyet-right {
            flex: 0 0 auto;
            width: 120px;
            border-left: 2px solid rgba(255, 193, 7, 0.6);
            padding-left: 8px;
        }
        
        .cost-options-compact {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .option-group-compact {
            margin-bottom: 0;
        }
        
        .radio-group-compact {
            display: flex;
            flex-direction: column;
            gap: 2px;
            margin-top: 2px;
        }
        
        .radio-label-compact {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 8px;
            color: #856404;
            margin: 0;
            white-space: nowrap;
        }
        
        .radio-label-compact:hover {
            color: #5a4103;
        }
        
        .radio-label-compact input[type="radio"] {
            width: auto;
            margin: 0 3px 0 0;
            padding: 0;
        }
        

        
        .radio-group-horizontal {
            display: flex;
            gap: 6px;
            margin-top: 2px;
            align-items: center;
            justify-content: flex-start;
        }
        
        .container-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }
        
        .container-title {
            font-size: 11px;
            font-weight: bold;
            color: #495057;
        }
        
        .container-controls-small {
            display: flex;
            gap: 3px;
        }
        
        .control-btn-small {
            width: 18px;
            height: 18px;
            border: 1px solid;
            border-radius: 3px;
            background: white;
            font-size: 10px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .control-btn-small.add {
            border-color: #28a745;
            color: #28a745;
        }
        
        .control-btn-small.add:hover {
            background: #28a745;
            color: white;
        }
        
        .control-btn-small.remove {
            border-color: #dc3545;
            color: #dc3545;
        }
        
        .control-btn-small.remove:hover {
            background: #dc3545;
            color: white;
        }
        
        .control-btn-small:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .add-container-btn {
            width: 160px;
            height: 120px;
            border: 2px dashed #28a745;
            border-radius: 6px;
            background: #f8fff9;
            color: #28a745;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            min-width: 160px;
            max-width: 160px;
        }

        .add-container-btn:hover {
            background: #e8f5e9;
            border-color: #1e7e34;
        }
        .calculation-container {
            display: flex;
            flex-direction: column;
            gap: 6px;
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            padding: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            width: 160px;
            min-width: 160px;
            max-width: 160px;
            box-sizing: border-box;
        }
        
        .calculation-container.color-1 { border-color: #007bff; }
        .calculation-container.color-2 { border-color: #28a745; }
        .calculation-container.color-3 { border-color: #ffc107; }
        .calculation-container.color-4 { border-color: #dc3545; }
        .calculation-container.color-5 { border-color: #6f42c1; }
        .calculation-container.color-6 { border-color: #fd7e14; }
        .calculation-container.color-7 { border-color: #20c997; }
        .calculation-container.color-8 { border-color: #e83e8c; }

        label {
            display: block;
            margin-bottom: 3px;
            font-weight: 600;
            color: #495057;
            font-size: 11px;
        }

        select,
        input {
            padding: 4px 6px;
            font-size: 10px;
            width: calc(100% - 12px);
            border: 1px solid #ced4da;
            border-radius: 3px;
            background-color: white;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }
        
        select:focus,
        input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
        }

        .result {
            font-weight: bold;
            font-size: 11px;
            margin-top: 6px;
            padding: 4px 6px;
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 3px;
            color: #0066cc;
            text-align: center;
        }
        #topresult, #genelresult {
            font-weight: bold;
            font-size: 14px;
            color: #087522;
            margin: 0;
            padding-top: 6px;
            border-top: 2px solid #28a745;
        }
        .t-header {
            background: #6c757d;
            color: white;
            font-weight: bold;
            font-size: 13px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            z-index: 5;
        }
        thead tr:nth-child(1) th:nth-child(1) {
            background: #a5a6a4 !important;
        }
        thead tr:nth-child(1) th:nth-child(2) {
            background: #343d44 !important;
        }
        thead tr:nth-child(1) th:nth-child(3) {
            background: #6d5649 !important;
        }
        thead tr:nth-child(1) th:nth-child(4) {
            background: #3f572d !important;
        }
        thead tr:nth-child(1) th:nth-child(5) {
            background: #3c647e !important;
        }
        thead tr:nth-child(1) th:nth-child(6) {
            background: #832b27 !important;
        }
        thead tr:nth-child(1) th:nth-child(7) {
            background: #c06e31 !important;
        }
        thead tr:nth-child(1) th:nth-child(8) {
            background: #ceb04a !important;
        }
        thead tr:nth-child(1) th:nth-child(9) {
            background: #cfd0d1 !important;
        }
        
    
        thead tr:nth-child(2) th:nth-child(1) {
            background: #343d44 !important;
        }
        thead tr:nth-child(2) th:nth-child(2) {
            background: #6d5649 !important;
        }
        thead tr:nth-child(2) th:nth-child(3) {
            background: #3f572d !important;
        }
        thead tr:nth-child(2) th:nth-child(4) {
            background: #3c647e !important;
        }
        thead tr:nth-child(2) th:nth-child(5) {
            background: #4ed376 !important;
        }
        thead tr:nth-child(2) th:nth-child(6) {
            background: #2ed3d2 !important;
        }
        thead tr:nth-child(2) th:nth-child(7) {
            background: #a371d7 !important;
        }
        thead tr:nth-child(2) th:nth-child(8) {
            background: #cfd053 !important;
        }
        thead tr:nth-child(2) th:nth-child(9) {
            background:  #832b27 !important;
        }
        thead tr:nth-child(2) th:nth-child(10) {
            background:  #5ed280 !important;
        }
        thead tr:nth-child(2) th:nth-child(11) {
            background:  #2ed3d2 !important;
        }
        thead tr:nth-child(2) th:nth-child(12) {
            background:  #a371d7 !important;
        }
        thead tr:nth-child(2) th:nth-child(13) {
            background:  #cfd053 !important;
        }
        thead tr:nth-child(2) th:nth-child(14) {
            background:  #c06e31 !important;
        }
        thead tr:nth-child(2) th:nth-child(15) {
            background:  #5ed280 !important;
        }
        thead tr:nth-child(2) th:nth-child(16) {
            background:  #2ed3d2 !important;
        }
        thead tr:nth-child(2) th:nth-child(17) {
            background:  #a371d7 !important;
        }
        thead tr:nth-child(2) th:nth-child(18) {
            background:  #cfd053 !important;
        }
        thead tr:nth-child(2) th:nth-child(19) {
            background:  #ceb04a !important;
        }
        thead tr:nth-child(2) th:nth-child(20) {
            background:  #5ed280 !important;
        }
        thead tr:nth-child(2) th:nth-child(21) {
            background:  #2ed3d2 !important;
        }
        thead tr:nth-child(2) th:nth-child(22) {
            background:  #a371d7 !important;
        }
        thead tr:nth-child(2) th:nth-child(23) {
            background:  #cfd053 !important;
        }
        thead tr:nth-child(2) th:nth-child(24) {
            background:  #cfd0d1 !important;
        }
        thead tr:nth-child(2) th:nth-child(25) {
            background:  #5ed280 !important;
        }
        thead tr:nth-child(2) th:nth-child(26) {
            background:  #2ed3d2 !important;
        }
        thead tr:nth-child(2) th:nth-child(27) {
            background:  #a371d7 !important;
        }
        thead tr:nth-child(2) th:nth-child(28) {
            background:  #cfd053 !important;
        }


        .t-header:hover {
            background: #5a6268;
            transform: scale(1.02);
        }
        
        .t-header.editing {
            background: #007bff;
        }
        
        .t-header input {
            background: transparent;
            border: none;
            color: white;
            font-weight: bold;
            font-size: 13px;
            text-align: center;
            width: 100%;
            outline: none;
        }
        
        .en-header {
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            background: #ddd;
            z-index: 1;
        }
        
        /* İlk sütundaki En-header için özel ayar */
        th:first-child.en-header {
            z-index: 9998 !important;
            position: sticky !important;
            left: 0 !important;
            background: #ddd !important;
            color: #495057 !important;
            border-right: 0.5px solid #ced4da !important;
        }
        
        /* İlk sütun her zaman görünür kalacak */
        th:first-child,
        td:first-child {
            position: sticky !important;
            left: 0 !important;
            z-index: 9999 !important;
            background: #f8f9fa !important;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            border-right: 3px solid #007bff !important;
        }
        
        th:first-child {
            background: #e9ecef !important;
            font-weight: bold;
            color: #495057;
        }
        
        .en-header:hover {
            background: #c3e6ff !important;
            transform: scale(1.05);
        }
        
        .en-header.editing {
            background: #007bff !important;
            color: white;
        }
        
        .en-header input {
            background: transparent;
            border: none;
            color: inherit;
            font-weight: bold;
            font-size: 12px;
            text-align: center;
            width: 100%;
            outline: none;
        }
        
        .en-header.editing input {
            color: white;
        }
        
        .table-scroll-hint {
            text-align: center;
            font-size: 11px;
            color: #6c757d;
            margin-bottom: 5px;
            font-style: italic;
        }
        
        .table-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 8px;
            padding: 8px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .control-btn {
            padding: 4px 8px;
            font-size: 11px;
            border: 1px solid;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        .control-btn.add-row {
            border-color: #28a745;
            color: #28a745;
        }
        
        .control-btn.add-row:hover {
            background: #28a745;
            color: white;
        }
        
        .control-btn.remove-row {
            border-color: #dc3545;
            color: #dc3545;
        }
        
        .control-btn.remove-row:hover {
            background: #dc3545;
            color: white;
        }
        
        .control-btn.add-col {
            border-color: #007bff;
            color: #007bff;
        }
        
        .control-btn.add-col:hover {
            background: #007bff;
            color: white;
        }
        
        .control-btn.remove-col {
            border-color: #ffc107;
            color: #856404;
        }
        
        .control-btn.remove-col:hover {
            background: #ffc107;
            color: #856404;
        }
        
        .control-label {
            font-size: 11px;
            font-weight: bold;
            color: #495057;
        }
        
        .add-row-cell {
            background: #f8f9fa !important;
            border: 2px dashed #28a745 !important;
            text-align: center;
            vertical-align: middle;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            color: #28a745;
            font-size: 11px;
        }
        
        .add-row-cell:hover {
            background: #e8f5e9 !important;
            border-color: #1e7e34 !important;
        }
        
        .add-col-header {
            background: #f8f9fa !important;
            border: 2px dashed #007bff !important;
            text-align: center;
            vertical-align: middle;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            color: #007bff;
            font-size: 11px;
            min-width: 60px;
            width: 60px;
        }
        
        .add-col-header:hover {
            background: #e3f2fd !important;
            border-color: #0056b3 !important;
        }
        
        .remove-row-btn, .remove-col-btn {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 3px;
            padding: 2px 6px;
            font-size: 10px;
            cursor: pointer;
            margin-left: 5px;
            transition: all 0.3s ease;
        }
        
        .remove-row-btn:hover, .remove-col-btn:hover {
            background: #c82333;
        }
        
        .column-name-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border: 2px solid #007bff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 1000;
            min-width: 300px;
        }
        
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }
        
        .popup-title {
            font-size: 16px;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .popup-input {
            width: 100%;
            padding: 8px 12px;
            font-size: 14px;
            border: 2px solid #dee2e6;
            border-radius: 4px;
            margin-bottom: 15px;
            box-sizing: border-box;
        }
        
        .popup-input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.25);
        }
        
        .popup-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .popup-btn {
            padding: 8px 16px;
            font-size: 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .popup-btn.confirm {
            background: #28a745;
            color: white;
        }
        
        .popup-btn.confirm:hover {
            background: #218838;
        }
        
        .popup-btn.cancel {
            background: #6c757d;
            color: white;
        }
        
        .popup-btn.cancel:hover {
            background: #5a6268;
        }
        
        .data-controls {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            padding: 10px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #dee2e6;
            border-radius: 8px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .data-btn {
            padding: 8px 16px;
            font-size: 12px;
            font-weight: bold;
            border: 2px solid;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            min-width: 120px;
            justify-content: center;
        }
        
        .data-btn.export {
            border-color: #17a2b8;
            color: #17a2b8;
        }
        
        .data-btn.export:hover {
            background: #17a2b8;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(23,162,184,0.3);
        }
        
        .data-btn.import {
            border-color: #28a745;
            color: #28a745;
        }
        
        .data-btn.import:hover {
            background: #28a745;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(40,167,69,0.3);
        }
        
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }
        
        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
            opacity: 0;
        }
        
        .data-controls-title {
            font-size: 14px;
            font-weight: bold;
            color: #495057;
            margin-right: 15px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
    </style>
</head>

<body>
    <!-- Veri İşlemleri Kontrolleri -->
    <div class="data-controls">
        <span class="data-controls-title">📊 Veri İşlemleri</span>
        <button class="data-btn export" onclick="exportData()">
            📥 Verileri İndir
        </button>
        <div class="file-input-wrapper">
            <input type="file" id="importFile" accept=".json" onchange="importData(event)">
            <button class="data-btn import" onclick="document.getElementById('importFile').click()">
                📤 Verileri Yükle
            </button>
        </div>
    </div>

<div class="wrapper">
    <!-- Soldaki tablo -->
    <div class="table-container">

        
        <div class="table-scroll-hint">
            ← Tabloyu sağa sola kaydırmak için scroll kullanın →
        </div>
        
    <table id="priceTable">
        <thead>
            <tr>
                <th rowspan="2">Ürün Adı</th>
                <th colspan="1" class="t-header">T1</th>
                <th colspan="1" class="t-header">T2</th>
                <th colspan="1" class="t-header">T3</th>
                <th colspan="5" class="t-header">T4</th>
                <th colspan="5" class="t-header">T5</th>
                <th colspan="5" class="t-header">T6</th>
                <th colspan="5" class="t-header">T7</th>
                <th colspan="5" class="t-header">T8</th>
            </tr>
            <tr>
                <th class="en-header">En0</th>
                <th class="en-header">En0</th>
                <th class="en-header">En0</th>
                <th class="en-header">En0</th><th class="en-header">En1</th><th class="en-header">En2</th><th class="en-header">En3</th><th class="en-header">En4</th>
                <th class="en-header">En0</th><th class="en-header">En1</th><th class="en-header">En2</th><th class="en-header">En3</th><th class="en-header">En4</th>
                <th class="en-header">En0</th><th class="en-header">En1</th><th class="en-header">En2</th><th class="en-header">En3</th><th class="en-header">En4</th>
                <th class="en-header">En0</th><th class="en-header">En1</th><th class="en-header">En2</th><th class="en-header">En3</th><th class="en-header">En4</th>
                <th class="en-header">En0</th><th class="en-header">En1</th><th class="en-header">En2</th><th class="en-header">En3</th><th class="en-header">En4</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td contenteditable="true">Seciniz</td>
                <td contenteditable="true">0</td>
                <td contenteditable="true">0</td>
                <td contenteditable="true">0</td>
                <td contenteditable="true">0</td><td contenteditable="true">0</td><td contenteditable="true">0</td><td contenteditable="true">0</td><td contenteditable="true">0</td>
                <td contenteditable="true">0</td><td contenteditable="true">0</td><td contenteditable="true">0</td><td contenteditable="true">0</td><td contenteditable="true">0</td>
                <td contenteditable="true">0</td><td contenteditable="true">0</td><td contenteditable="true">0</td><td contenteditable="true">0</td><td contenteditable="true">0</td>
                <td contenteditable="true">0</td><td contenteditable="true">0</td><td contenteditable="true">0</td><td contenteditable="true">0</td><td contenteditable="true">0</td>
                <td contenteditable="true">0</td><td contenteditable="true">0</td><td contenteditable="true">0</td><td contenteditable="true">0</td><td contenteditable="true">0</td>
            </tr>
            <tr>
                <td contenteditable="true">Plank</td>
                <td contenteditable="true">0</td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
            </tr>
            <tr>
                <td contenteditable="true">Cloth</td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
            </tr>
            <tr>
                <td contenteditable="true">Leather</td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
            </tr>
            <tr>
                <td contenteditable="true">Metal Bar</td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
            </tr>
            <tr>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
            </tr>
            <tr>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
            </tr>
            <tr>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
            </tr>
            <tr>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
            </tr>
            <tr>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
            </tr>
            <tr>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
                <td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td>
            </tr>
        </tbody>
    </table>
    </div>
    <div>
<div class="flexbox">
    <!-- Dinamik Konteynerler -->
    <div id="dynamicContainers"></div>
</div>

<div class="topmaliyet">
    <div class="total-box">
        <h4 style="margin: 0 0 6px 0; color: #087522; font-size: 12px;">🔨 Kaynaklar</h4>
        <div class="total-box-indicators"></div>
        <div id="topresult">Toplam Fiyat: 0</div>
    </div>
    <div class="total-box maliyet">
        <div class="maliyet-content">
            <div class="maliyet-left">
                <h4 style="margin: 0 0 6px 0; color: #856404; font-size: 12px;">💰 Toplam Maliyet</h4>
                <div class="total-box-indicators"></div>
                <div id="genelresult" style="margin-top: 6px;">Toplam Fiyat: 0</div>
            </div>
            
            <div class="maliyet-right">
                <div class="cost-options-compact">
                    <div class="option-group-compact">
                        <label for="premiumSelect" style="font-size: 12px; margin-bottom: 4px; color: #856404; font-weight: bold; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">💰 Vergi:</label>
                        <select id="premiumSelect" style="width: 100%; padding: 2px 4px; font-size: 9px; border: 1px solid #ffc107; border-radius: 3px; background: white;">
                            <option value="">Vergisiz</option>
                            <option value="premium">Premium (+%4)</option>
                            <option value="non-premium">Premium Değil (+%8)</option>
        </select>
                    </div>
                    
                    <div class="option-group-compact">
                        <label style="font-size: 12px; margin-bottom: 4px; color: #856404; font-weight: bold; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">💳 İşlem Ücreti:</label>
                        <div class="radio-group-horizontal">
                            <label class="radio-label-compact">
                                <input type="radio" name="feeOption" value="" checked style="margin-right: 3px;">
                                <span style="font-size: 8px;">Ücretsiz</span>
                            </label>
                            <label class="radio-label-compact">
                                <input type="radio" name="feeOption" value="fee" style="margin-right: 3px;">
                                <span style="font-size: 8px;">Fee (+%2.5)</span>
                            </label>
    </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
</div>
    
    <script>
        let containerCount = 4;
        
                // Dinamik konteyner oluşturma fonksiyonu
        function createContainer(index) {
            const container = document.createElement('div');
            container.className = `calculation-container color-${index}`;
            container.id = `container${index}`;
            
            const removeBtn = containerCount > 1 ? 
                `<button class="control-btn-small remove" onclick="removeContainer(${index})" title="Kutuyu Sil">×</button>` : '';
            
            const addBtn = index === containerCount && containerCount < 8 ? 
                `<button class="control-btn-small add" onclick="addContainer()" title="Yeni Kutu Ekle">+</button>` : '';
            
            container.innerHTML = `
                <div class="container-header">
                    <span class="container-title">Kutu ${index}</span>
                    <div class="container-controls-small">
                        ${addBtn}
                        ${removeBtn}
    </div>
    </div>
                
                <label for="productSelect${index}">Ürün Seçiniz:</label>
                <select id="productSelect${index}"></select>

                <label for="levelSelect${index}">Seviye Seçiniz (T1 - T8):</label>
                <select id="levelSelect${index}">
            <option value="1">T1</option>
            <option value="2">T2</option>
            <option value="3">T3</option>
            <option value="4">T4</option>
            <option value="5">T5</option>
            <option value="6">T6</option>
            <option value="7">T7</option>
            <option value="8">T8</option>
        </select>

                <label for="subLevelSelect${index}">Alt Seviye Seçiniz:</label>
                <select id="subLevelSelect${index}">
                    <option value="0">En0</option>
                    <option value="1">En1</option>
                    <option value="2">En2</option>
                    <option value="3">En3</option>
                    <option value="4">En4</option>
                </select>

                <label for="quantityInput${index}">Miktar Giriniz:</label>
                <input type="number" id="quantityInput${index}" min="0" value="1" />

                <label for="result${index}">Toplam Fiyat:</label>
                <div class="result" id="result${index}">0</div>
            `;
            
            return container;
        }
        
        // Artı kutusu oluşturma
        function createAddButton() {
            if (containerCount >= 8) return null;
            
            const addContainer = document.createElement('div');
            addContainer.className = 'add-container-btn';
            addContainer.innerHTML = '+ Yeni Kutu Ekle';
            addContainer.onclick = addContainer;
            
            return addContainer;
        }

        // Mevcut değerleri kaydetme
        function saveCurrentValues() {
            const savedValues = {};
            for (let i = 1; i <= containerCount; i++) {
                const productSelect = document.getElementById(`productSelect${i}`);
                const levelSelect = document.getElementById(`levelSelect${i}`);
                const subLevelSelect = document.getElementById(`subLevelSelect${i}`);
                const quantityInput = document.getElementById(`quantityInput${i}`);
                
                if (productSelect && levelSelect && subLevelSelect && quantityInput) {
                    savedValues[i] = {
                        product: productSelect.value,
                        level: levelSelect.value,
                        subLevel: subLevelSelect.value,
                        quantity: quantityInput.value
                    };
                }
            }
            return savedValues;
        }

        // Kayıtlı değerleri geri yükleme
        function restoreValues(savedValues) {
            for (let i = 1; i <= containerCount; i++) {
                if (savedValues[i]) {
                    const productSelect = document.getElementById(`productSelect${i}`);
                    const levelSelect = document.getElementById(`levelSelect${i}`);
                    const subLevelSelect = document.getElementById(`subLevelSelect${i}`);
                    const quantityInput = document.getElementById(`quantityInput${i}`);
                    
                    if (productSelect) productSelect.value = savedValues[i].product;
                    if (levelSelect) levelSelect.value = savedValues[i].level;
                    if (subLevelSelect) subLevelSelect.value = savedValues[i].subLevel;
                    if (quantityInput) quantityInput.value = savedValues[i].quantity;
                }
            }
        }

        // Tüm konteynerleri başlatma
        function initializeContainers() {
            const savedValues = saveCurrentValues();
            const dynamicContainers = document.getElementById('dynamicContainers');
            dynamicContainers.innerHTML = '';
            
            for (let i = 1; i <= containerCount; i++) {
                const container = createContainer(i);
                dynamicContainers.appendChild(container);
            }
            
            updateProductList();
            // Alt seviye seçeneklerini güncelle
            for (let i = 1; i <= containerCount; i++) {
                updateSubLevelOptions(i);
            }
            restoreValues(savedValues);
            addEventListeners();
            calculateTotal();
            updateTotalBoxIndicators();
            updateTotalBoxSizes();
        }

        // Event listener'ları ekleme
        function addEventListeners() {
            for (let i = 1; i <= containerCount; i++) {
                const productSelect = document.getElementById(`productSelect${i}`);
                const levelSelect = document.getElementById(`levelSelect${i}`);
                const subLevelSelect = document.getElementById(`subLevelSelect${i}`);
                const quantityInput = document.getElementById(`quantityInput${i}`);
                
                if (productSelect) {
                    productSelect.addEventListener('change', calculateTotal);
                    productSelect.addEventListener('change', saveContainerValues);
                }
                if (levelSelect) {
                    levelSelect.addEventListener('change', () => {
                        updateSubLevelOptions(i);
                        calculateTotal();
                        saveContainerValues();
                    });
                }
                if (subLevelSelect) {
                    subLevelSelect.addEventListener('change', calculateTotal);
                    subLevelSelect.addEventListener('change', saveContainerValues);
                }
                if (quantityInput) {
                    quantityInput.addEventListener('input', calculateTotal);
                    quantityInput.addEventListener('input', saveContainerValues);
                }
            }
        }

        // Alt seviye seçeneklerini T-seviyesine göre güncelle
        function updateSubLevelOptions(containerIndex) {
            const levelSelect = document.getElementById(`levelSelect${containerIndex}`);
            if (!levelSelect) return;
            
            const selectedLevel = parseInt(levelSelect.value);
            updateSubLevelOptionsWithCustomNames(containerIndex, selectedLevel);
        }

        // Ürünleri tablo satırlarından çekip select'e ekle
        function updateProductList() {
            const table = document.getElementById('priceTable').getElementsByTagName('tbody')[0];
            
            for (let i = 1; i <= containerCount; i++) {
                const select = document.getElementById(`productSelect${i}`);
                if (select) {
                    select.innerHTML = '';

            for (let row of table.rows) {
                const productName = row.cells[0].textContent.trim();
                if (productName) {
                    let option = document.createElement('option');
                    option.value = productName;
                    option.textContent = productName;
                            select.appendChild(option);
                        }
                    }
                }
            }
        }

        // Hesaplama fonksiyonu
        function calculateTotal() {
            let toptotal = 0;
            let geneltotal = 0;
            
            for (let i = 1; i <= containerCount; i++) {
                const productSelect = document.getElementById(`productSelect${i}`);
                const levelSelect = document.getElementById(`levelSelect${i}`);
                const subLevelSelect = document.getElementById(`subLevelSelect${i}`);
                const quantityInput = document.getElementById(`quantityInput${i}`);
                const resultDiv = document.getElementById(`result${i}`);
                
                if (!productSelect || !levelSelect || !subLevelSelect || !quantityInput || !resultDiv) continue;
                
                const productName = productSelect.value;
                const level = parseInt(levelSelect.value);
                const subLevel = parseInt(subLevelSelect.value);
                const quantity = parseFloat(quantityInput.value);
                const table = document.getElementById('priceTable').getElementsByTagName('tbody')[0];
                let price = 0;

                for (let row of table.rows) {
                    if (row.cells[0].textContent.trim() === productName) {
                        let columnIndex;
                        
                        if (level <= 3) {
                            // T1, T2, T3: sadece En0 var (kolonlar 1, 2, 3)
                            columnIndex = level;
                        } else {
                            // T4-T8: En0, En1, En2, En3, En4 var
                            // T4 başlangıcı: kolon 4 (3 + 1)
                            columnIndex = 3 + (level - 4) * 5 + (subLevel + 1);
                        }
                        
                        const priceText = row.cells[columnIndex].textContent.trim();
                        price = parseFloat(priceText) || 0;
                        break;
                    }
                }
                
                const total = price * quantity;
                resultDiv.textContent = `${total.toFixed(2)}`;
                
                if (i == 1 || i == 2) {
                    toptotal += total;
                }
                geneltotal += total;
            }
            
            // Premium ve fee hesaplamaları
            const premiumSelect = document.getElementById('premiumSelect');
            const feeRadios = document.querySelectorAll('input[name="feeOption"]');
            
            let finalTotal = geneltotal;
            let premiumMultiplier = 1;
            let feeMultiplier = 1;
            
            // Premium hesaplama
            if (premiumSelect && premiumSelect.value) {
                if (premiumSelect.value === 'premium') {
                    premiumMultiplier = 1.04; // +%4
                } else if (premiumSelect.value === 'non-premium') {
                    premiumMultiplier = 1.08; // +%8
                }
            }
            
            // Fee hesaplama
            const selectedFee = Array.from(feeRadios).find(radio => radio.checked);
            if (selectedFee && selectedFee.value === 'fee') {
                feeMultiplier = 1.025; // +%2.5
            }
            
            finalTotal = geneltotal * premiumMultiplier * feeMultiplier;
            
            document.getElementById(`topresult`).textContent = `Kaynaklar Fiyati: ${toptotal.toFixed(2)}`;
            document.getElementById(`genelresult`).textContent = `Toplam Maliyet: ${finalTotal.toFixed(2)}`;
        }

        // Toplam kutuları içindeki göstergeleri güncelleme
        function updateTotalBoxIndicators() {
            // Kaynaklar kutusundaki göstergeler (ilk 2 kutu)
            const resourcesBox = document.querySelector('.total-box:first-child .total-box-indicators');
            if (resourcesBox) {
                let resourcesHTML = '';
                for (let i = 1; i <= Math.min(2, containerCount); i++) {
                    if (i > 1) resourcesHTML += '<span>+</span>';
                    resourcesHTML += `<div class="box-indicator box${i}">${i}</div>`;
                }
                resourcesBox.innerHTML = resourcesHTML;
            }
            
            // Toplam kutusundaki göstergeler (tüm kutular)
            const totalBox = document.querySelector('.total-box.maliyet .total-box-indicators');
            if (totalBox) {
                let totalHTML = '';
                for (let i = 1; i <= containerCount; i++) {
                    if (i > 1) totalHTML += '<span>+</span>';
                    totalHTML += `<div class="box-indicator box${i}">${i}</div>`;
                }
                totalBox.innerHTML = totalHTML;
            }
        }

        // Toplam kutularının boyutunu güncelleme
        function updateTotalBoxSizes() {
            const topmaliyetContainer = document.querySelector('.topmaliyet');
            const resourcesBox = topmaliyetContainer.querySelector('.total-box:first-child');
            const totalBox = topmaliyetContainer.querySelector('.total-box:last-child');
            
            // Her kutu için sabit genişlik ve gap
            const containerWidth = 160; // Her kutu genişliği
            const gapSize = 8; // Kutular arası boşluk
            
            // Kaynaklar kutusu: Her zaman 2 kutu genişliğinde (160 + 8 + 160 = 328px)
            const resourcesWidth = 2 * containerWidth + gapSize; // 328px
            
            // Toplam kutusu: Kalan kutuların genişliğinde + ekstra genişlik vergi/fee seçenekleri için
            const remainingBoxes = Math.max(1, containerCount - 2); // En az 1 kutu
            const baseTotalWidth = remainingBoxes * containerWidth + Math.max(0, remainingBoxes - 1) * gapSize;
            const totalWidth = Math.max(baseTotalWidth, 300); // En az 300px genişlik
            
            if (resourcesBox) {
                resourcesBox.style.width = `${resourcesWidth}px`;
                resourcesBox.style.maxWidth = `${resourcesWidth}px`;
                resourcesBox.style.minWidth = `${resourcesWidth}px`;
            }
            
            if (totalBox) {
                totalBox.style.width = `${totalWidth}px`;
                totalBox.style.maxWidth = `${totalWidth}px`;
                totalBox.style.minWidth = `${totalWidth}px`;
            }
            
            // Ana konteyner genişliğini toplam genişliğe göre ayarla
            const totalContainerWidth = resourcesWidth + totalWidth + gapSize; // İki kutu + aralarındaki gap
            if (topmaliyetContainer) {
                topmaliyetContainer.style.width = `${Math.min(totalContainerWidth, window.innerWidth - 20)}px`;
                topmaliyetContainer.style.maxWidth = '100%';
                topmaliyetContainer.style.justifyContent = 'center';
                topmaliyetContainer.style.gap = '8px';
            }
        }

        // Konteyner ekleme
        function addContainer() {
            if (containerCount < 8) {
                containerCount++;
                initializeContainers();
                saveContainerValues();
            }
        }

        // Konteyner çıkarma
        function removeContainer(indexToRemove = null) {
            if (containerCount > 1) {
                const savedValues = saveCurrentValues();
                
                // Eğer belirli bir index silinecekse, değerleri yeniden düzenle
                if (indexToRemove && indexToRemove < containerCount) {
                    const newSavedValues = {};
                    let newIndex = 1;
                    
                    for (let i = 1; i <= containerCount; i++) {
                        if (i !== indexToRemove && savedValues[i]) {
                            newSavedValues[newIndex] = savedValues[i];
                            newIndex++;
                        }
                    }
                    
                    containerCount--;
                    const dynamicContainers = document.getElementById('dynamicContainers');
                    dynamicContainers.innerHTML = '';
                    
                    for (let i = 1; i <= containerCount; i++) {
                        const container = createContainer(i);
                        dynamicContainers.appendChild(container);
                    }
                    
        updateProductList();
                     restoreValues(newSavedValues);
                     addEventListeners();
                     calculateTotal();
                     updateTotalBoxIndicators();
                     updateTotalBoxSizes();
                    saveContainerValues();
                } else {
                    // Normal silme (son kutu)
                    containerCount--;
                    initializeContainers();
                    saveContainerValues();
                }
            }
        }



                        // Kutu değerlerini localStorage'a kaydetme
        function saveContainerValues() {
            const containerData = {
                count: containerCount,
                values: {}
            };
            
            for (let i = 1; i <= containerCount; i++) {
                const productSelect = document.getElementById(`productSelect${i}`);
                const levelSelect = document.getElementById(`levelSelect${i}`);
                const subLevelSelect = document.getElementById(`subLevelSelect${i}`);
                const quantityInput = document.getElementById(`quantityInput${i}`);
                
                if (productSelect && levelSelect && subLevelSelect && quantityInput) {
                    containerData.values[i] = {
                        product: productSelect.value,
                        level: levelSelect.value,
                        subLevel: subLevelSelect.value,
                        quantity: quantityInput.value
                    };
                }
            }
            
            localStorage.setItem('containerData', JSON.stringify(containerData));
        }

        // localStorage'dan kutu değerlerini geri yükleme
        function loadContainerValues() {
            const savedData = localStorage.getItem('containerData');
            if (savedData) {
                try {
                    const containerData = JSON.parse(savedData);
                    
                    // Kaydedilen kutu sayısını geri yükle
                    if (containerData.count) {
                        containerCount = containerData.count;
                    }
                    
                    // Konteynerleri oluştur
                    initializeContainers();
                    
                    // Değerleri geri yükle
                    if (containerData.values) {
                        setTimeout(() => { // DOM'un hazır olmasını bekle
                            for (let i = 1; i <= containerCount; i++) {
                                if (containerData.values[i]) {
                                    const productSelect = document.getElementById(`productSelect${i}`);
                                    const levelSelect = document.getElementById(`levelSelect${i}`);
                                    const subLevelSelect = document.getElementById(`subLevelSelect${i}`);
                                    const quantityInput = document.getElementById(`quantityInput${i}`);
                                    
                                    if (productSelect) productSelect.value = containerData.values[i].product || '';
                                    if (levelSelect) {
                                        levelSelect.value = containerData.values[i].level || '1';
                                        // Alt seviye seçeneklerini güncelle
                                        updateSubLevelOptions(i);
                                    }
                                    if (subLevelSelect) subLevelSelect.value = containerData.values[i].subLevel || '0';
                                    if (quantityInput) quantityInput.value = containerData.values[i].quantity || '1';
                                }
                            }
                            calculateTotal();
                        }, 100);
                    }
                } catch (error) {
                    console.error('Kaydedilen veriler yüklenirken hata:', error);
                    initializeContainers();
                }
            } else {
                initializeContainers();
            }
        }



        // Premium ve fee seçeneklerini kaydetme/yükleme
        function savePremiumFeeOptions() {
            const premiumSelect = document.getElementById('premiumSelect');
            const feeRadios = document.querySelectorAll('input[name="feeOption"]');
            const selectedFee = Array.from(feeRadios).find(radio => radio.checked);
            
            const options = {
                premium: premiumSelect ? premiumSelect.value : '',
                fee: selectedFee ? selectedFee.value : ''
            };
            
            localStorage.setItem('premiumFeeOptions', JSON.stringify(options));
        }
        
        function loadPremiumFeeOptions() {
            const savedOptions = localStorage.getItem('premiumFeeOptions');
            if (savedOptions) {
                try {
                    const options = JSON.parse(savedOptions);
                    
                    const premiumSelect = document.getElementById('premiumSelect');
                    if (premiumSelect && options.premium !== undefined) {
                        premiumSelect.value = options.premium;
                    }
                    
                    const feeRadios = document.querySelectorAll('input[name="feeOption"]');
                    feeRadios.forEach(radio => {
                        if (radio.value === options.fee) {
                            radio.checked = true;
                        }
                    });
                } catch (error) {
                    console.error('Premium/Fee seçenekleri yüklenirken hata:', error);
                }
            }
        }

        // Sayfa yüklendiğinde
        document.addEventListener('DOMContentLoaded', () => {
            // Önce tablo verilerini yükle
            loadTableFromStorage();
            
            // Sonra kutu verilerini yükle (bu şekilde ürün listesi doğru olur)
            loadContainerValues();
            
            // Premium ve fee seçeneklerini yükle
            loadPremiumFeeOptions();
            
            // Header düzenleme listener'larını ekle
            setTimeout(() => {
                addHeaderEditListeners();
            }, 200);
            
            // Tablo değişikliklerini dinle
        document.getElementById('priceTable').addEventListener('input', () => {
            updateProductList();
            calculateTotal();
            });

            // Premium ve fee seçeneklerini dinle
            const premiumSelect = document.getElementById('premiumSelect');
            if (premiumSelect) {
                premiumSelect.addEventListener('change', () => {
                    calculateTotal();
                    savePremiumFeeOptions();
                });
            }
            
            const feeRadios = document.querySelectorAll('input[name="feeOption"]');
            feeRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    calculateTotal();
                    savePremiumFeeOptions();
                });
            });

            // Pencere boyutu değiştiğinde kutular yeniden boyutlandır
            window.addEventListener('resize', updateTotalBoxSizes);
        });

        // Data Export/Import Functions
        function exportData() {
            try {
                // Local storage'dan tüm verileri topla - sadece mevcut olanları
                const exportData = {
                    version: "1.0", // Version kontrolü için
                    timestamp: new Date().toISOString(),
                    data: {}
                };

                // Sadece gerçekten var olan verileri export et (boş/default değerleri değil)
                const priceTableData = localStorage.getItem('priceTableData');
                if (priceTableData) {
                    exportData.data.priceTableData = JSON.parse(priceTableData);
                }

                const containerData = localStorage.getItem('containerData');
                if (containerData) {
                    exportData.data.containerData = JSON.parse(containerData);
                }

                const premiumFeeOptions = localStorage.getItem('premiumFeeOptions');
                if (premiumFeeOptions) {
                    exportData.data.premiumFeeOptions = JSON.parse(premiumFeeOptions);
                }

                const tableHeaders = localStorage.getItem('tableHeaders');
                if (tableHeaders) {
                    exportData.data.tableHeaders = JSON.parse(tableHeaders);
                }

                // JSON string'e çevir
                const jsonString = JSON.stringify(exportData, null, 2);
                
                // Blob oluştur
                const blob = new Blob([jsonString], { type: 'application/json' });
                
                // Download linki oluştur
                const downloadLink = document.createElement('a');
                downloadLink.href = URL.createObjectURL(blob);
                
                // Dosya adı (tarih-saat ile)
                const now = new Date();
                const dateStr = now.toISOString().slice(0, 19).replace(/[T:]/g, '-');
                downloadLink.download = `urun-fiyat-verileri-${dateStr}.json`;
                
                // Download'ı başlat
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                
                // Export edilen veri sayısını göster
                const exportedItems = Object.keys(exportData.data);
                const message = exportedItems.length > 0 
                    ? `✅ Veriler başarıyla indirildi!\n\nExport edilen veriler:\n• ${exportedItems.join('\n• ')}`
                    : '⚠️ Henüz kaydedilmiş veri bulunamadı.\nTabloda değişiklik yaptıktan sonra tekrar deneyin.';
                
                alert(message);
                
            } catch (error) {
                console.error('Export error:', error);
                alert('❌ Veri indirme sırasında hata oluştu: ' + error.message);
            }
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Dosya tipini kontrol et
            if (file.type !== 'application/json' && !file.name.endsWith('.json')) {
                alert('❌ Lütfen geçerli bir JSON dosyası seçin!');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                                 try {
                     // JSON'ı parse et
                     const importedData = JSON.parse(e.target.result);
                     console.log(importedData);
                     
                     // Veri yapısını kontrol et
                     if (!importedData.data) {
                         throw new Error('Geçersiz veri formatı!');
                     }

                     // Onay al
                     const confirmation = confirm('⚠️ Bu işlem mevcut tüm verileri değiştirecek. Devam etmek istiyor musunuz?');
                     if (!confirmation) return;

                     // Local storage'ı güncelle - sadece import edilen verilerde olan alanları
                     const data = importedData.data;
                     
                     // Her veri tipini kontrol ederek kaydet - sadece gerçekten var olanları
                     if (data.hasOwnProperty('priceTableData') && Array.isArray(data.priceTableData)) {
                         localStorage.setItem('priceTableData', JSON.stringify(data.priceTableData));
                     }
                     
                     if (data.hasOwnProperty('containerData') && typeof data.containerData === 'object') {
                         // containerData yapısını kontrol et
                         const containerData = {
                             count: parseInt(data.containerData.count) || 4,
                             values: data.containerData.values || {}
                         };
                         localStorage.setItem('containerData', JSON.stringify(containerData));
                     }
                     
                     if (data.hasOwnProperty('premiumFeeOptions') && typeof data.premiumFeeOptions === 'object') {
                         const premiumFeeOptions = {
                             premium: data.premiumFeeOptions.premium || '',
                             fee: data.premiumFeeOptions.fee || ''
                         };
                         localStorage.setItem('premiumFeeOptions', JSON.stringify(premiumFeeOptions));
                     }
                     
                     if (data.hasOwnProperty('tableHeaders') && typeof data.tableHeaders === 'object') {
                         const tableHeaders = {
                             row1: Array.isArray(data.tableHeaders.row1) ? data.tableHeaders.row1 : [],
                             row2: Array.isArray(data.tableHeaders.row2) ? data.tableHeaders.row2 : []
                         };
                         localStorage.setItem('tableHeaders', JSON.stringify(tableHeaders));
                     }

                    // Başarı mesajı
                    alert('✅ Veriler başarıyla yüklendi! Sayfa yenileniyor...');
                    
                    // Sayfayı yenile (tüm verileri yeniden yüklemek için)
                    setTimeout(() => {
                        window.location.reload();
                    }, 500);

                } catch (error) {
                    console.error('Import error:', error);
                    alert('❌ Veri yükleme sırasında hata oluştu: ' + error.message);
                }
            };

            reader.onerror = function() {
                alert('❌ Dosya okuma hatası!');
            };

            // Dosyayı oku
            reader.readAsText(file);
            
            // Input'u temizle (aynı dosyayı tekrar seçebilmek için)
            event.target.value = '';
        }

        // Helper function: Local storage veri tiplerini kontrol et
        function validateLocalStorageData() {
            try {
                const priceTableData = localStorage.getItem('priceTableData');
                const containerData = localStorage.getItem('containerData');
                const premiumFeeOptions = localStorage.getItem('premiumFeeOptions');
                const tableHeaders = localStorage.getItem('tableHeaders');

                // Her birinin JSON parse edilebilir olduğunu kontrol et
                if (priceTableData) JSON.parse(priceTableData);
                if (containerData) JSON.parse(containerData);
                if (premiumFeeOptions) JSON.parse(premiumFeeOptions);
                if (tableHeaders) JSON.parse(tableHeaders);

                return true;
            } catch (error) {
                console.warn('Local storage data validation failed:', error);
                return false;
            }
        }
    </script>
    
    <script>
        const table = document.getElementById('priceTable');
        
        // Verileri tabloya uygula
        function loadTableFromStorage() {
            const savedData = localStorage.getItem('priceTableData');
            if (savedData) {
                const data = JSON.parse(savedData);
                const tbody = table.getElementsByTagName('tbody')[0];
                
                // Mevcut satırları temizle (+ Satır Ekle hariç)
                const existingRows = tbody.querySelectorAll('tr:not(.add-row-cell)');
                existingRows.forEach(row => {
                    if (!row.querySelector('.add-row-cell')) {
                        row.remove();
                    }
                });
                
                // Mevcut sütun sayısını hesapla (+ Sütun Ekle hariç)
                const headerRow2 = table.querySelector('thead tr:last-child');
                let totalColumns = 0;
                for (let i = 0; i < headerRow2.cells.length; i++) {
                    if (!headerRow2.cells[i].classList.contains('add-col-header')) {
                        totalColumns++;
                    }
                }
                
                // Kaydedilen verileri yükle
                data.forEach((rowData, rowIndex) => {
                    if (rowData.length > 0) {
                        const newRow = tbody.insertRow(rowIndex);
                        
                        // Tüm sütunlar için hücre oluştur
                        for (let colIndex = 0; colIndex < totalColumns; colIndex++) {
                            const cell = newRow.insertCell();
                            cell.contentEditable = true;
                            
                            // Kaydedilen veri varsa kullan, yoksa boş bırak
                            if (colIndex < rowData.length) {
                                cell.innerText = rowData[colIndex] || '';
                            } else {
                                cell.innerText = '';
                            }
                        }
                        
                        // Son boş hücre ekle (+ Sütun Ekle alanı için)
                        const emptyCell = newRow.insertCell();
                        emptyCell.textContent = '';
                        
                        // Event listener'ları ekle
                        addInputListenersToNewRow(newRow);
                    }
                });
            }
        }
        
        // Tabloyu oku ve localStorage'a kaydet
        function saveTableToStorage() {
            const data = [];
            const rows = table.querySelectorAll('tbody tr');
            rows.forEach(row => {
                // "Satır Ekle" satırını kaydetme
                if (!row.querySelector('.add-row-cell')) {
                const rowData = [];
                row.querySelectorAll('td').forEach(cell => {
                    rowData.push(cell.innerText.trim());
                });
                data.push(rowData);
                }
            });
            localStorage.setItem('priceTableData', JSON.stringify(data));
        }
        
        // Değişiklikleri dinle
        table.addEventListener('input', saveTableToStorage);
        
        // Header'ları kaydetme
        function saveTableHeaders() {
            const table = document.getElementById('priceTable');
            const thead = table.getElementsByTagName('thead')[0];
            const headerData = {
                row1: [],
                row2: []
            };
            
            // İlk satır header'ları (T-level'lar)
            const headerRow1 = thead.rows[0];
            for (let i = 0; i < headerRow1.cells.length; i++) {
                const cell = headerRow1.cells[i];
                if (!cell.classList.contains('add-col-header')) {
                    headerData.row1.push({
                        text: cell.textContent,
                        colSpan: cell.colSpan || 1,
                        className: cell.className
                    });
                }
            }
            
            // İkinci satır header'ları (En-level'lar)
            const headerRow2 = thead.rows[1];
            for (let i = 0; i < headerRow2.cells.length; i++) {
                const cell = headerRow2.cells[i];
                if (!cell.classList.contains('add-col-header')) {
                    headerData.row2.push({
                        text: cell.textContent,
                        className: cell.className
                    });
                }
            }
            
            localStorage.setItem('tableHeaders', JSON.stringify(headerData));
        }
        
        // Header'ları yükleme
        function loadTableHeaders() {
            const savedHeaders = localStorage.getItem('tableHeaders');
            if (savedHeaders) {
                const headerData = JSON.parse(savedHeaders);
                const table = document.getElementById('priceTable');
                const thead = table.getElementsByTagName('thead')[0];
                
                // Mevcut header'ları temizle (İlk sütun ve + Sütun Ekle hariç)
                const headerRow1 = thead.rows[0];
                const headerRow2 = thead.rows[1];
                
                // İlk satırı temizle (Ürün Adı ve + Sütun Ekle hariç)
                const cellsToRemove1 = [];
                for (let i = 1; i < headerRow1.cells.length; i++) {
                    if (!headerRow1.cells[i].classList.contains('add-col-header')) {
                        cellsToRemove1.push(headerRow1.cells[i]);
                    }
                }
                cellsToRemove1.forEach(cell => headerRow1.removeChild(cell));
                
                // İkinci satırı temizle (İlk sütun ve + Sütun Ekle hariç)
                const cellsToRemove2 = [];
                for (let i = 1; i < headerRow2.cells.length; i++) {
                    if (!headerRow2.cells[i].classList.contains('add-col-header')) {
                        cellsToRemove2.push(headerRow2.cells[i]);
                    }
                }
                cellsToRemove2.forEach(cell => headerRow2.removeChild(cell));
                
                // İlk satır header'ları yükle (Ürün Adı hariç)
                headerData.row1.forEach((headerInfo, index) => {
                    if (index > 0) { // İlk sütunu (Ürün Adı) atla
                        const newHeader = document.createElement('th');
                        newHeader.textContent = headerInfo.text;
                        newHeader.className = headerInfo.className;
                        if (headerInfo.colSpan > 1) {
                            newHeader.colSpan = headerInfo.colSpan;
                        }
                        
                        // + Sütun Ekle butonundan önce ekle
                        const addColButton = headerRow1.querySelector('.add-col-header');
                        if (addColButton) {
                            headerRow1.insertBefore(newHeader, addColButton);
                        } else {
                            headerRow1.appendChild(newHeader);
                        }
                    }
                });
                
                // İkinci satır header'ları yükle (İlk sütun hariç)
                headerData.row2.forEach((headerInfo, index) => {
                    if (index > 0) { // İlk sütunu atla
                        const newHeader = document.createElement('th');
                        newHeader.textContent = headerInfo.text;
                        newHeader.className = headerInfo.className;
                        
                        // + Sütun Ekle butonundan önce ekle
                        const addColButton = headerRow2.querySelector('.add-col-header');
                        if (addColButton) {
                            headerRow2.insertBefore(newHeader, addColButton);
                        } else {
                            headerRow2.appendChild(newHeader);
                        }
                    }
                });
            }
        }
        
        // Sayfa yüklendiğinde verileri yükle
        window.addEventListener('DOMContentLoaded', () => {
            // Önce header'ları yükle
            loadTableHeaders();
            // Sonra tablo verilerini yükle
            loadTableFromStorage();
            // Kısa bir gecikme ile butonları ekle (tablo yüklendikten sonra)
            setTimeout(() => {
                initializeTableButtons();
                addHeaderEditListeners();
            }, 100);
        });
        
        // Tablo satır ekleme
        function addTableRow() {
            const table = document.getElementById('priceTable');
            const tbody = table.getElementsByTagName('tbody')[0];
            
            // Son satırı (+ Yeni Satır Ekle) kaldır
            const addRowElement = tbody.querySelector('.add-row-cell');
            if (addRowElement) {
                addRowElement.parentElement.remove();
            }
            
            // Yeni normal satır ekle
            const newRow = tbody.insertRow();
            
            // İlk hücre (ürün adı)
            const productCell = newRow.insertCell();
            productCell.contentEditable = true;
            productCell.textContent = '';
            
            // Diğer hücreler (fiyat hücreleri) - son sütun (+ Sütun Ekle) hariç
            const headerRow = table.querySelector('thead tr:last-child');
            const columnCount = headerRow.cells.length - 2; // İlk sütun ve son sütun hariç
            
            for (let i = 0; i < columnCount; i++) {
                const cell = newRow.insertCell();
                cell.contentEditable = true;
                cell.textContent = '';
            }
            
            // Son hücre boş (sütun ekleme alanı için)
            const emptyCell = newRow.insertCell();
            emptyCell.textContent = '';
            
            // Yeni "Satır Ekle" satırını tekrar ekle
            addTableRowButton();
            
            // Tabloyu hemen kaydet
            saveTableToStorage();
            updateProductList();
            
            // Yeni satıra input event listener ekle
            addInputListenersToNewRow(newRow);
        }
        
        // Yeni satıra input event listener ekleme
        function addInputListenersToNewRow(row) {
            const cells = row.querySelectorAll('td[contenteditable="true"]');
            cells.forEach(cell => {
                cell.addEventListener('input', function() {
                    saveTableToStorage();
                    updateProductList();
                });
                
                cell.addEventListener('blur', function() {
                    saveTableToStorage();
                    updateProductList();
                });
            });
        }
        
        // Tablo satır silme
        function removeTableRow() {
            const table = document.getElementById('priceTable');
            const tbody = table.getElementsByTagName('tbody')[0];
            
            // + Satır Ekle hariç gerçek satır sayısını bul
            const realRows = tbody.querySelectorAll('tr:not(.add-row-cell)');
            
            if (realRows.length > 1) {
                // Son gerçek satırı sil (+ Satır Ekle hariç)
                let lastRealRow = null;
                for (let i = tbody.rows.length - 1; i >= 0; i--) {
                    if (!tbody.rows[i].querySelector('.add-row-cell')) {
                        lastRealRow = tbody.rows[i];
                        break;
                    }
                }
                
                if (lastRealRow) {
                    tbody.removeChild(lastRealRow);
                    saveTableToStorage();
                    updateProductList();
                }
            } else {
                alert('En az bir satır olmalı!');
            }
        }
        
        // Sütun ismi popup'ını göster
        function showColumnNamePopup() {
            const overlay = document.createElement('div');
            overlay.className = 'popup-overlay';
            
            const popup = document.createElement('div');
            popup.className = 'column-name-popup';
            
            popup.innerHTML = `
                <div class="popup-title">📊 Yeni Sütun İsmi</div>
                <input type="text" class="popup-input" id="columnNameInput" placeholder="Örnek: T9, Seviye9, Özel vb." maxlength="20">
                <div class="popup-buttons">
                    <button class="popup-btn confirm" onclick="confirmAddColumn()">✅ Ekle</button>
                    <button class="popup-btn cancel" onclick="cancelAddColumn()">❌ İptal</button>
                </div>
            `;
            
            document.body.appendChild(overlay);
            document.body.appendChild(popup);
            
            // Input'a odaklan
            const input = document.getElementById('columnNameInput');
            input.focus();
            
            // Enter tuşu ile onaylama
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    confirmAddColumn();
                }
            });
            
            // Escape tuşu ile iptal
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    cancelAddColumn();
                }
            });
            
            // Overlay'e tıklayınca iptal
            overlay.onclick = cancelAddColumn;
        }
        
        // Sütun eklemeyi onayla
        function confirmAddColumn() {
            const input = document.getElementById('columnNameInput');
            let columnName = input.value.trim();
            
            if (!columnName) {
                columnName = `T${getCurrentTCount()}`;
            }
            
            // Popup'ı kapat
            closeColumnPopup();
            
            // Sütunu ekle
            addTableColumnWithName(columnName);
        }
        
        // Sütun eklemeyi iptal et
        function cancelAddColumn() {
            closeColumnPopup();
        }
        
        // Popup'ı kapat
        function closeColumnPopup() {
            const overlay = document.querySelector('.popup-overlay');
            const popup = document.querySelector('.column-name-popup');
            
            if (overlay) overlay.remove();
            if (popup) popup.remove();
        }
        
        // Tablo sütun ekleme (isimli)
        function addTableColumnWithName(columnName) {
            const table = document.getElementById('priceTable');
            const thead = table.getElementsByTagName('thead')[0];
            const tbody = table.getElementsByTagName('tbody')[0];
            
            // Header'dan son sütunu (+ Sütun Ekle) kaldır
            const headerRow1 = thead.rows[0];
            const headerRow2 = thead.rows[1];
            
            if (headerRow1.cells[headerRow1.cells.length - 1].classList.contains('add-col-header')) {
                headerRow1.removeChild(headerRow1.cells[headerRow1.cells.length - 1]);
            }
            if (headerRow2.cells[headerRow2.cells.length - 1].classList.contains('add-col-header')) {
                headerRow2.removeChild(headerRow2.cells[headerRow2.cells.length - 1]);
            }
            
            // İlk satıra yeni T-level başlığı ekle
            const newTHeader = document.createElement('th');
            newTHeader.className = 't-header';
            newTHeader.colSpan = 5;
            newTHeader.textContent = columnName;
            headerRow1.appendChild(newTHeader);
            
            // İkinci satıra En0-En4 başlıkları ekle
            for (let i = 0; i <= 4; i++) {
                const newEnHeader = document.createElement('th');
                newEnHeader.className = 'en-header';
                newEnHeader.textContent = `En${i}`;
                headerRow2.appendChild(newEnHeader);
            }
            
            // Tüm satırlara yeni hücreler ekle (son hücre hariç)
            for (let row of tbody.rows) {
                if (!row.querySelector('.add-row-cell')) {
                    // Son hücreyi kaldır
                    if (row.cells.length > 0) {
                        row.removeChild(row.cells[row.cells.length - 1]);
                    }
                    
                    // 5 yeni hücre ekle
                    for (let i = 0; i < 5; i++) {
                        const newCell = row.insertCell();
                        newCell.contentEditable = true;
                        newCell.textContent = '';
                        
                        // Yeni hücreye event listener ekle
                        newCell.addEventListener('input', function() {
                            saveTableToStorage();
                            saveTableHeaders();
                        });
                        
                        newCell.addEventListener('blur', function() {
                            saveTableToStorage();
                            saveTableHeaders();
                        });
                    }
                    
                    // Son boş hücreyi tekrar ekle
                    const emptyCell = row.insertCell();
                    emptyCell.textContent = '';
                }
            }
            
            // Sütun ekleme butonunu tekrar ekle
            addTableColumnButton();
            
            // Header düzenleme listener'larını güncelle
            addHeaderEditListeners();
            
            // Hem tablo verilerini hem header'ları kaydet
            saveTableToStorage();
            saveTableHeaders();
        }
        
        // Eski fonksiyonu popup çağıracak şekilde güncelle
        function addTableColumn() {
            showColumnNamePopup();
        }
        
        // Tablo sütun silme
        function removeTableColumn() {
            const table = document.getElementById('priceTable');
            const thead = table.getElementsByTagName('thead')[0];
            const tbody = table.getElementsByTagName('tbody')[0];
            
            const headerRow1 = thead.rows[0];
            const headerRow2 = thead.rows[1];
            
            // En az 3 T-level olmalı (T1, T2, T3)
            if (getCurrentTCount() <= 3) {
                alert('En az 3 T-level (T1, T2, T3) olmalı!');
                return;
            }
            
            // Son T-level'ı sil (+ Sütun Ekle hariç)
            let lastTHeader = null;
            for (let i = headerRow1.cells.length - 1; i >= 0; i--) {
                if (!headerRow1.cells[i].classList.contains('add-col-header')) {
                    lastTHeader = headerRow1.cells[i];
                    break;
                }
            }
            
            if (!lastTHeader) return;
            
            const colSpan = parseInt(lastTHeader.colSpan) || 1;
            
            // Header'dan sil
            headerRow1.removeChild(lastTHeader);
            
            // İkinci satırdan En başlıklarını sil (+ Sütun Ekle hariç)
            for (let i = 0; i < colSpan; i++) {
                for (let j = headerRow2.cells.length - 1; j >= 0; j--) {
                    if (!headerRow2.cells[j].classList.contains('add-col-header')) {
                        headerRow2.removeChild(headerRow2.cells[j]);
                        break;
                    }
                }
            }
            
            // Tüm satırlardan son hücreleri sil (+ Satır Ekle ve boş hücreler hariç)
            for (let row of tbody.rows) {
                if (!row.querySelector('.add-row-cell')) {
                    for (let i = 0; i < colSpan; i++) {
                        // Son hücreyi bul (boş hücre değil)
                        for (let j = row.cells.length - 1; j >= 0; j--) {
                            const cell = row.cells[j];
                            if (cell.contentEditable === 'true') {
                                row.removeChild(cell);
                                break;
                            }
                        }
                    }
                }
            }
            
            // Hem tablo verilerini hem header'ları kaydet
            saveTableToStorage();
            saveTableHeaders();
        }
        
        // Mevcut T-level sayısını hesapla
        function getCurrentTCount() {
            const table = document.getElementById('priceTable');
            const headerRow1 = table.querySelector('thead tr:first-child');
            let count = 0;
            for (let i = 1; i < headerRow1.cells.length; i++) {
                if (headerRow1.cells[i].classList.contains('t-header')) {
                    count++;
                }
            }
            return count + 1; // Yeni T-level numarası
        }
        
        // Tabloya satır ekleme butonu ekle
        function addTableRowButton() {
            const table = document.getElementById('priceTable');
            const tbody = table.getElementsByTagName('tbody')[0];
            const headerRow = table.querySelector('thead tr:last-child');
            const columnCount = headerRow.cells.length;
            
            const addRow = tbody.insertRow();
            const addCell = addRow.insertCell();
            addCell.className = 'add-row-cell';
            addCell.colSpan = columnCount;
            addCell.innerHTML = '+ Yeni Satır Ekle <button class="remove-row-btn" onclick="event.stopPropagation(); removeTableRow();">Son Satırı Sil</button>';
            addCell.onclick = function(e) {
                if (e.target.tagName !== 'BUTTON') {
                    addTableRow();
                }
            };
        }
        
        // Tabloya sütun ekleme butonu ekle
        function addTableColumnButton() {
            const table = document.getElementById('priceTable');
            const thead = table.getElementsByTagName('thead')[0];
            const tbody = table.getElementsByTagName('tbody')[0];
            
            // Header'a sütun ekleme butonu
            const headerRow1 = thead.rows[0];
            const headerRow2 = thead.rows[1];
            
            const addColHeader1 = document.createElement('th');
            addColHeader1.className = 'add-col-header';
            addColHeader1.rowSpan = 2;
            addColHeader1.innerHTML = '+ Sütun<br>Ekle <button class="remove-col-btn" onclick="event.stopPropagation(); removeTableColumn();">Sil</button>';
            addColHeader1.onclick = function(e) {
                if (e.target.tagName !== 'BUTTON') {
                    addTableColumn();
                }
            };
            headerRow1.appendChild(addColHeader1);
            
            // Body satırlarına boş hücre ekle
            for (let row of tbody.rows) {
                if (!row.querySelector('.add-row-cell')) {
                    const emptyCell = row.insertCell();
                    emptyCell.textContent = '';
                }
            }
        }
        
        // Tabloyu başlangıç durumuna getir
        function initializeTableButtons() {
            addTableRowButton();
            addTableColumnButton();
            addHeaderEditListeners();
        }
        
        // T-header ve En-header'lara düzenleme özelliği ekle
        function addHeaderEditListeners() {
            // T-header'lar için
            const tHeaders = document.querySelectorAll('.t-header');
            tHeaders.forEach(header => {
                if (!header.classList.contains('add-col-header') && !header.hasAttribute('data-editable')) {
                    header.setAttribute('data-editable', 'true');
                    header.addEventListener('dblclick', function() {
                        editHeaderName(this, 'T');
                    });
                }
            });
            
            // En-header'lar için
            const enHeaders = document.querySelectorAll('.en-header');
            enHeaders.forEach(header => {
                if (!header.hasAttribute('data-editable')) {
                    header.setAttribute('data-editable', 'true');
                    header.addEventListener('dblclick', function() {
                        editHeaderName(this, 'En');
                    });
                }
            });
        }
        
        // Header ismini düzenle
        function editHeaderName(header, type) {
            console.log('editHeaderName çağrıldı:', header, type); // Debug
            
            if (header.querySelector('input')) return; // Zaten düzenleniyor
            
            const currentText = header.textContent;
            header.classList.add('editing');
            
            const input = document.createElement('input');
            input.type = 'text';
            input.value = currentText;
            input.maxLength = type === 'T' ? 20 : 15; // T-header'lar daha uzun olabilir
            
            // Placeholder metni
            if (type === 'T') {
                input.placeholder = 'Örn: T9, Seviye9, Özel';
            } else {
                input.placeholder = 'Örn: En0, Alt1, Bonus';
            }
            
            header.innerHTML = '';
            header.appendChild(input);
            
            input.focus();
            input.select();
            
            // Enter ile kaydet
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    saveHeaderName(header, input.value.trim() || currentText, type);
                }
            });
            
            // Escape ile iptal
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    saveHeaderName(header, currentText, type);
                }
            });
            
            // Focus kaybedince kaydet
            input.addEventListener('blur', function() {
                saveHeaderName(header, input.value.trim() || currentText, type);
            });
        }
        
        // Header ismini kaydet
        function saveHeaderName(header, newName, type) {
            header.classList.remove('editing');
            header.textContent = newName;
            
            // Eğer En-header düzenlendiyse, dropdown'ları da güncelle
            if (type === 'En') {
                updateDropdownOptions();
            }
            
            // Hem tablo verilerini hem header'ları kaydet
            saveTableToStorage();
            saveTableHeaders();
        }
        
        // Dropdown seçeneklerini güncelle (En-header'lar değiştiğinde)
        function updateDropdownOptions() {
            // Tüm alt seviye dropdown'larını güncelle
            for (let i = 1; i <= containerCount; i++) {
                const levelSelect = document.getElementById(`levelSelect${i}`);
                const subLevelSelect = document.getElementById(`subLevelSelect${i}`);
                
                if (levelSelect && subLevelSelect) {
                    const selectedLevel = parseInt(levelSelect.value);
                    updateSubLevelOptionsWithCustomNames(i, selectedLevel);
                }
            }
        }
        
        // Alt seviye seçeneklerini özel isimlerle güncelle
        function updateSubLevelOptionsWithCustomNames(containerIndex, selectedLevel) {
            const subLevelSelect = document.getElementById(`subLevelSelect${containerIndex}`);
            if (!subLevelSelect) return;
            
            const currentValue = subLevelSelect.value;
            subLevelSelect.innerHTML = '';
            
            // Tablodaki En-header'ları oku
            const table = document.getElementById('priceTable');
            const headerRow2 = table.querySelector('thead tr:last-child');
            
            let startIndex, endIndex;
            
            if (selectedLevel <= 3) {
                // T1, T2, T3 için sadece ilk En-header
                startIndex = selectedLevel; // T1=1, T2=2, T3=3
                endIndex = startIndex;
            } else {
                // T4-T8 için 5 En-header
                startIndex = 3 + (selectedLevel - 4) * 5 + 1; // T4 başlangıcı: 3 + 0*5 + 1 = 4
                endIndex = startIndex + 4; // 5 header (0-4)
            }
            
            // En-header'ları dropdown'a ekle
            for (let i = startIndex; i <= endIndex; i++) {
                if (headerRow2.cells[i] && headerRow2.cells[i].classList.contains('en-header')) {
                    const option = document.createElement('option');
                    option.value = (i - startIndex).toString(); // 0, 1, 2, 3, 4
                    option.textContent = headerRow2.cells[i].textContent;
                    subLevelSelect.appendChild(option);
                }
            }
            
            // Mümkünse önceki değeri koru
            if (subLevelSelect.querySelector(`option[value="${currentValue}"]`)) {
                subLevelSelect.value = currentValue;
            } else {
                subLevelSelect.value = '0';
            }
        }
    </script>

</body>

</html>
</html>